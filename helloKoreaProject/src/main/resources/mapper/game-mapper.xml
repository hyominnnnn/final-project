<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="gameMapper">
	
	<resultMap id="gameResultSet" type="lowerGame">
		<result column="QUIZ_NO" property="quizNo" />
		<result column="QUIZ_CONTENT" property="quizContent" />
		<result column="FIRST_CHOICE" property="firstChoice" />
		<result column="SECOND_CHOICE" property="secondChoice" />
		<result column="CORRECT" property="correct" />
		<result column="LEVEL_NO" property="levelNo" />
	</resultMap>

	<resultMap id="scoreResultSet" type="score">
		<result column="LEVEL_NO" property="levelNo" />
		<result column="TEST_DATE" property="testDate" />
		<result column="SCORE" property="score" />
	</resultMap>
	
	<select id="firstQuiz" resultMap="gameResultSet">
		SELECT
			   QUIZ_NO,
			   QUIZ_CONTENT,
			   FIRST_CHOICE,
			   SECOND_CHOICE,
			   CORRECT,
			   LEVEL_NO
		  FROM 
			   TB_LOWER_GAME
		 WHERE 
		 	   QUIZ_NO = 1
		   AND 
		 	   STATUS = 'Y'
	</select>
	
	<select id="lastNo" resultType="_int">
		SELECT
			   MAX(QUIZ_NO)
  		  FROM 
  		  	   TB_LOWER_GAME
	</select>
	
	<select id="nextQuiz" parameterType="_int" resultMap="gameResultSet">
		SELECT
			   QUIZ_NO,
			   QUIZ_CONTENT,
			   FIRST_CHOICE,
			   SECOND_CHOICE,
			   CORRECT
		  FROM 
			   TB_LOWER_GAME
		 WHERE 
		 	   QUIZ_NO = #{ quizNo } + 1
		   AND 
		 	   STATUS = 'Y'
	</select>
	
	<select id="prevQuiz" parameterType="_int" resultMap="gameResultSet">
		SELECT
			   QUIZ_NO,
			   QUIZ_CONTENT,
			   FIRST_CHOICE,
			   SECOND_CHOICE,
			   CORRECT
		  FROM 
			   TB_LOWER_GAME
		 WHERE 
		 	   QUIZ_NO = #{ quizNo } - 1
		   AND 
		 	   STATUS = 'Y'
	</select>
	
	<!-- 정답 개수 -->
	<select id="checkAnswer" parameterType="list" resultType="_int">
		SELECT
			   COUNT(QUIZ_NO)
		  FROM 
		  	   TB_LOWER_GAME
		 WHERE 
		 <foreach item="answer" collection="list" open="(" close=")" separator="OR">
		 	   QUIZ_NO = #{answer.no}
		   AND
		 	   CORRECT = #{answer.answer}
		 </foreach>
	</select>
	
	<!-- 점수 insert -->
	<insert id="insertScore" parameterType="hashmap">
		INSERT
		  INTO
		  	   TB_SCORE
		  	   (
		  	   MEMBER_NO,
		  	   LEVEL_NO,
		  	   SCORE
		  	   )
		VALUES 
			   (
			   #{ memberNo },
			   #{ levelNo },
			   #{ score }
			   )
	</insert>
	
	<!-- 사용자의 난이도별 점수 가져오기 -->
	<select id="selectScore" parameterType="_int" resultMap="scoreResultSet">
		SELECT
			   LEVEL_NO,
			   TEST_DATE,
			   SCORE
		  FROM 
		  	   TB_SCORE
		 WHERE 
		 	    MEMBER_NO = #{ memberNo }
		 ORDER
		    BY
		        LEVEL_NO DESC
	</select>
	
</mapper>